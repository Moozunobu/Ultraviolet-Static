<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dual Browser Pro (UV Mode)</title>
    
    <!-- ‚ñ†‚ñ†‚ñ† UV„Å´ÂøÖË¶Å„Å™„Çπ„ÇØ„É™„Éó„ÉàÔºà„Åì„Åì„ÅåÈáçË¶ÅÔºâ ‚ñ†‚ñ†‚ñ† -->
    <script src="uv/uv.bundle.js"></script>
    <script src="uv/uv.config.js"></script>
    <!-- „Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„ÅÆÁôªÈå≤ -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js', {
                    scope: __uv$config.prefix
                });
            });
        }
    </script>
    <!-- ‚ñ†‚ñ†‚ñ† „Åì„Åì„Åæ„Åß ‚ñ†‚ñ†‚ñ† -->

    <style>
        /* „ÅÇ„Å™„Åü„ÅÆCSS„Ç≥„Éº„Éâ */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, sans-serif; background-color: #F2F2F7; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { background-color: #fff; border-bottom: 1px solid #ccc; padding: 10px; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .toolbar { display: flex; gap: 8px; margin-bottom: 8px; }
        .url-input-container { display: flex; flex-grow: 1; position: relative; }
        #url-input { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #ccc; background: #eee; outline: none; font-size: 16px; }
        #url-input:focus { background: #fff; border-color: #007aff; }
        .btn { border: none; border-radius: 8px; padding: 0 16px; font-weight: bold; cursor: pointer; color: white; white-space: nowrap; font-size: 14px; }
        .btn-go { background-color: #007aff; }
        .btn-split { background-color: #5856D6; }
        .btn:active { opacity: 0.8; }
        .hint-text { font-size: 11px; color: #ff3b30; margin-top: 4px; display: none; }
        .tabs-wrapper { display: flex; align-items: center; overflow: hidden; margin-top: 5px; }
        .tabs-scroll { display: flex; overflow-x: auto; gap: 5px; scrollbar-width: none; flex-grow: 1; }
        .tabs-scroll::-webkit-scrollbar { display: none; }
        .tab { background: #e5e5ea; padding: 8px 12px; border-radius: 8px 8px 0 0; font-size: 12px; display: flex; align-items: center; min-width: 100px; max-width: 160px; cursor: pointer; user-select: none; }
        .tab.active { background: #fff; font-weight: bold; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .tab-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }
        .tab-close { width: 18px; text-align: center; border-radius: 50%; margin-left: 5px; color: #888; }
        .tab-close:hover { background: #ccc; color: #000; }
        .add-tab-btn { padding: 0 12px; font-size: 20px; color: #007aff; cursor: pointer; }
        .content-area { flex-grow: 1; position: relative; background: #fff; display: flex; }
        iframe { width: 100%; height: 100%; border: none; display: none; }
        iframe.active { display: block; }
        .content-area.split-mode iframe.active { width: 50%; border-right: 1px solid #ccc; }
        iframe.split-secondary { display: block !important; width: 50%; }
    </style>
</head>
<body>

    <div class="header">
        <div class="toolbar">
            <button class="btn btn-split" onclick="toggleSplit()">1ÁîªÈù¢/2ÁîªÈù¢</button>
            <div class="url-input-container">
                <input type="text" id="url-input" placeholder="Ê§úÁ¥¢„ÉØ„Éº„Éâ „Åæ„Åü„ÅØ URL„ÇíË≤º„Çä‰ªò„Åë">
            </div>
            <button class="btn btn-go" onclick="processInput()">Èñã„Åè</button>
        </div>
        <div class="hint-text" id="youtube-hint">üí° YouTube„É™„É≥„ÇØ„ÇíÊ§úÁü•ÔºÅ„Éó„É≠„Ç≠„Ç∑ÁµåÁî±„ÅßÂÜçÁîü„Åó„Åæ„Åô</div>
        <div class="tabs-wrapper">
            <div class="tabs-scroll" id="tabs-list"></div>
            <div class="add-tab-btn" onclick="createTab()">+</div>
        </div>
    </div>

    <div class="content-area" id="frames-container"></div>

    <script>
        let tabs = [];
        let activeTabId = null;
        let tabCounter = 0;
        let isSplit = false;

        // ‚ñ†‚ñ†‚ñ† UVÂ§âÊèõÁî®„ÅÆÈñ¢Êï∞ ‚ñ†‚ñ†‚ñ†
        function uvUrl(url) {
            // UV„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„ÅæËøî„Åô
            if (!window.__uv$config) return url;
            return window.location.origin + window.__uv$config.prefix + window.__uv$config.encodeUrl(url);
        }

        window.onload = () => {
            // Google„ÇíÈñã„ÅèÔºàUVÁµåÁî±Ôºâ
            createTab('https://www.google.com', 'Google');
        };

        function processInput() {
            const input = document.getElementById('url-input').value.trim();
            if (!input) return;

            // YouTube„É™„É≥„ÇØÂà§ÂÆö
            if (input.includes('youtube.com') || input.includes('youtu.be')) {
                showHint();
                // „É™„É≥„ÇØ„Åù„ÅÆ„Åæ„Åæ„ÅßOKÔºàUV„ÅåÂá¶ÁêÜ„Åô„Çã„Åã„ÇâEmbed„Å´„Åô„ÇãÂøÖË¶Å„Å™„ÅóÔºÅÔºâ
                createTab(input, 'YouTube');
            } else {
                if (!activeTabId) createTab();
                let url = input;
                if (!input.startsWith('http') && !input.includes('.')) {
                    url = `https://www.google.com/search?q=${encodeURIComponent(input)}`;
                } else if (!input.startsWith('http')) {
                    url = 'https://' + input;
                }
                updateCurrentTab(url, input);
            }
        }

        function showHint() {
            const hint = document.getElementById('youtube-hint');
            hint.style.display = 'block';
            setTimeout(() => { hint.style.display = 'none'; }, 4000);
        }

        function createTab(url = '', title = 'Êñ∞Ë¶è„Çø„Éñ') {
            tabCounter++;
            const tabId = `tab-${tabCounter}`;
            
            const tabEl = document.createElement('div');
            tabEl.className = 'tab';
            tabEl.id = `btn-${tabId}`;
            tabEl.innerHTML = `<span class="tab-title">${title}</span><span class="tab-close" onclick="closeTab('${tabId}', event)">√ó</span>`;
            tabEl.onclick = () => switchTab(tabId);
            document.getElementById('tabs-list').appendChild(tabEl);

            const iframe = document.createElement('iframe');
            iframe.id = `frame-${tabId}`;
            
            // ‚ñ†‚ñ†‚ñ† „Åì„Åì„ÅßUVÁµåÁî±„ÅÆURL„Å´Â§âÊèõ„Åó„Å¶„Çª„ÉÉ„Éà ‚ñ†‚ñ†‚ñ†
            if (url) iframe.src = uvUrl(url);
            
            document.getElementById('frames-container').appendChild(iframe);
            tabs.push({ id: tabId, url: url, title: title });
            switchTab(tabId);
        }

        function updateCurrentTab(url, titleInput) {
            if (!activeTabId) return;
            const iframe = document.getElementById(`frame-${activeTabId}`);
            
            // ‚ñ†‚ñ†‚ñ† „Åì„Åì„Åß„ÇÇUVÂ§âÊèõ ‚ñ†‚ñ†‚ñ†
            iframe.src = uvUrl(url);
            
            const tabData = tabs.find(t => t.id === activeTabId);
            if(tabData) {
                tabData.url = url;
                tabData.title = titleInput;
                document.querySelector(`#btn-${activeTabId} .tab-title`).innerText = titleInput;
            }
        }

        function switchTab(tabId) {
            activeTabId = tabId;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('iframe').forEach(i => {
                i.classList.remove('active');
                i.classList.remove('split-secondary');
            });
            document.getElementById(`btn-${tabId}`).classList.add('active');
            document.getElementById(`frame-${tabId}`).classList.add('active');
            const currentTab = tabs.find(t => t.id === tabId);
            if (currentTab) document.getElementById('url-input').value = currentTab.url;

            if (isSplit && tabs.length >= 2) {
                const idx = tabs.findIndex(t => t.id === tabId);
                const secondTab = tabs[idx + 1] || tabs[idx - 1];
                if (secondTab) {
                    document.getElementById(`frame-${secondTab.id}`).classList.add('split-secondary');
                }
            }
        }

        function closeTab(tabId, e) {
            e.stopPropagation();
            const idx = tabs.findIndex(t => t.id === tabId);
            if (idx === -1) return;
            document.getElementById(`btn-${tabId}`).remove();
            document.getElementById(`frame-${tabId}`).remove();
            tabs.splice(idx, 1);
            if (tabs.length === 0) {
                createTab('https://www.google.com', 'Google');
            } else if (activeTabId === tabId) {
                switchTab(tabs[tabs.length - 1].id);
            } else {
                if (isSplit) switchTab(activeTabId);
            }
        }

        function toggleSplit() {
            isSplit = !isSplit;
            const container = document.getElementById('frames-container');
            if (isSplit) container.classList.add('split-mode');
            else container.classList.remove('split-mode');
            if (activeTabId) switchTab(activeTabId);
        }

        document.getElementById('url-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') processInput();
        });
    </script>
</body>
</html>
